2025-05-17 06:30:30,890 - INFO - Using device: cuda
2025-05-17 06:30:30,891 - INFO - Starting diabetic retinopathy detection workflow...
2025-05-17 06:30:30,891 - INFO - Loading data...
2025-05-17 06:30:30,896 - INFO - Class distribution:
2025-05-17 06:30:30,899 - INFO - 
diagnosis
0    1628
1     340
2     896
3     176
4     255
Name: count, dtype: int64
2025-05-17 06:30:30,903 - INFO - Training samples: 2636, Validation samples: 659
2025-05-17 06:30:35,667 - INFO - Found 2636 valid images out of 2636
2025-05-17 06:30:36,843 - INFO - Found 659 valid images out of 659
2025-05-17 06:30:36,843 - INFO - Building EfficientNet-B3 model...
2025-05-17 06:30:37,131 - INFO - Starting training...
2025-05-17 06:37:13,686 - INFO - Epoch 1/3 - Train Loss: 0.7872, Val Loss: 2.1560, Val Kappa: 0.8051, Time: 396.6s
2025-05-17 06:37:13,886 - INFO - Checkpoint saved: /workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/checkpoints/checkpoint_epoch_1.pth
2025-05-17 06:37:14,003 - INFO - Best model saved with Kappa: 0.8051
2025-05-17 06:43:52,831 - INFO - Epoch 2/3 - Train Loss: 0.6248, Val Loss: 0.7601, Val Kappa: 0.7331, Time: 398.8s
2025-05-17 06:43:53,030 - INFO - Checkpoint saved: /workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/checkpoints/checkpoint_epoch_2.pth
2025-05-17 06:43:53,030 - INFO - No improvement in validation Kappa. Patience: 1/2
2025-05-17 06:50:31,948 - INFO - Epoch 3/3 - Train Loss: 0.5810, Val Loss: 0.6793, Val Kappa: 0.8108, Time: 398.9s
2025-05-17 06:50:32,146 - INFO - Checkpoint saved: /workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/checkpoints/checkpoint_epoch_3.pth
2025-05-17 06:50:32,261 - INFO - Best model saved with Kappa: 0.8108
2025-05-17 06:50:32,261 - INFO - Training completed in 1195.1 seconds
2025-05-17 06:50:32,261 - INFO - Best validation Kappa: 0.8108
2025-05-17 06:50:32,360 - INFO - Evaluating model...
2025-05-17 06:51:48,568 - INFO - Quadratic Weighted Kappa: 0.8108
2025-05-17 06:51:48,568 - INFO - Accuracy: 0.7618
2025-05-17 06:51:48,568 - INFO - 
Per-class metrics:
2025-05-17 06:51:48,568 - INFO - Class 0 - Precision: 0.9608, Recall: 0.9785, F1: 0.9696
2025-05-17 06:51:48,568 - INFO - Class 1 - Precision: 0.4396, Recall: 0.5882, F1: 0.5031
2025-05-17 06:51:48,568 - INFO - Class 2 - Precision: 0.6053, Recall: 0.7709, F1: 0.6781
2025-05-17 06:51:48,568 - INFO - Class 3 - Precision: 0.0000, Recall: 0.0000, F1: 0.0000
2025-05-17 06:51:48,568 - INFO - Class 4 - Precision: 0.6250, Recall: 0.0980, F1: 0.1695
2025-05-17 06:51:48,740 - INFO - Workflow completed successfully!
2025-05-17 06:53:50,283 - INFO - Using device: cuda
2025-05-17 06:53:50,284 - INFO - Starting diabetic retinopathy detection workflow...
2025-05-17 06:53:50,284 - INFO - Loading data...
2025-05-17 06:53:50,290 - INFO - Class distribution:
2025-05-17 06:53:50,293 - INFO - 
diagnosis
0    1628
1     340
2     896
3     176
4     255
Name: count, dtype: int64
2025-05-17 06:53:50,297 - INFO - Training samples: 2636, Validation samples: 659
2025-05-17 06:53:55,140 - INFO - Found 2636 valid images out of 2636
2025-05-17 06:53:56,339 - INFO - Found 659 valid images out of 659
2025-05-17 06:53:56,340 - INFO - Building EfficientNet-B3 model...
2025-05-17 06:53:56,681 - INFO - Starting training...
2025-05-17 06:54:16,843 - ERROR - Error in workflow: [Errno 32] Broken pipe
Traceback (most recent call last):
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 1191, in __iter__
    self.update(n - last_print_n)
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 1242, in update
    self.refresh(lock_args=self.lock_args)
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 1347, in refresh
    self.display()
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 1495, in display
    self.sp(self.__str__() if msg is None else msg)
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 459, in print_status
    fp_write('\r' + s + (' ' * max(last_len[0] - len_s, 0)))
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 452, in fp_write
    fp.write(str(s))
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/utils.py", line 196, in inner
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/diabetic_retinopathy_detection.py", line 316, in main
    model = train_model(model, train_loader, val_loader, criterion, optimizer, NUM_EPOCHS)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/diabetic_retinopathy_detection.py", line 166, in train_model
    for inputs, labels in tqdm(train_loader, desc=f"Epoch {epoch+1}/{num_epochs} [Train]", leave=False):
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 1196, in __iter__
    self.close()
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 1306, in close
    if self.display(msg='', pos=pos) and not pos:
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 1495, in display
    self.sp(self.__str__() if msg is None else msg)
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 459, in print_status
    fp_write('\r' + s + (' ' * max(last_len[0] - len_s, 0)))
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/std.py", line 452, in fp_write
    fp.write(str(s))
  File "/workspace/mle_ca8b2f40-eef3-409b-a194-81d2bf9608b8/venv/lib/python3.12/site-packages/tqdm/utils.py", line 196, in inner
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
BrokenPipeError: [Errno 32] Broken pipe
